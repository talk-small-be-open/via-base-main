- name: git repo VIA base code
  become_user: "{{remoteUser}}"
  git:
    repo: "{{via.baseRepository.gitUrl}}"
    dest: "{{via.installationPath}}/via_base"
    accept_hostkey: yes
    update: yes
    force: no

- name: Sticky folder permissions for webserver (www-data)
  file:
    path: "{{via.installationPath}}/via_base/web_root"
    state: directory
#    recurse: yes
    mode: "u=rwxs,g=rxs,o=rxs"
    owner: '{{remoteUser}}'
    group: 'www-data'

- name: Ensure readable folder permissions for webserver (www-data)
  file:
    path: "{{via.installationPath}}/via_base/web_root"
    state: directory
    recurse: yes
    mode: "g+r"
    group: 'www-data'

  
- name: git repo VIA site code
  become_user: "{{remoteUser}}"
  git:
    repo: "{{via.siteRepository.gitUrl}}"
    dest: "{{via.installationPath}}/via_site"
    accept_hostkey: yes
    update: yes
    force: no
